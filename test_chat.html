<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Chat</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.2/+esm" type="module"></script><style>body{background:#000;color:#fff;font-family:sans-serif;padding:2em}#messages{height:300px;overflow-y:auto;border:1px solid #333;background:#111;padding:1em;margin-bottom:1em}.msg{margin-bottom:.5em;padding:.5em;border-radius:.5em;max-width:80%;word-wrap:break-word}.msg.me{background-color:#1e3a5f;text-align:right;margin-left:auto}.msg.other{background-color:#333;text-align:left;margin-right:auto}button,input{font-size:1em;padding:.5em;margin-right:.5em}</style></head><body><h1>ðŸ’¬ Chat</h1><p id="roomInfo"></p><div id="messages"></div><input id="nameInput" placeholder="Nom ou pseudo"> <input id="msgInput" placeholder="Message"> <button id="sendBtn">Envoyer</button><script type="module">import{createClient}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.2/+esm";const supabaseUrl="https://crdzcgqrakjjdujhqmic.supabase.co",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZHpjZ3FyYWtqamR1amhxbWljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyNTQ2MDAsImV4cCI6MjA2MjgzMDYwMH0.F32OEbuWNwRAbmiaAK5WMMvCfopXc6pIvh9CgX0sLY8",supabase=createClient(supabaseUrl,supabaseKey);let uid=localStorage.getItem("chat_uid");uid||(uid=crypto.randomUUID(),localStorage.setItem("chat_uid",uid));const params=new URLSearchParams(window.location.search),room=params.get("room")||"default";document.getElementById("roomInfo").textContent="Salon : "+room;const messagesDiv=document.getElementById("messages"),nameInput=document.getElementById("nameInput"),msgInput=document.getElementById("msgInput"),sendBtn=document.getElementById("sendBtn");function addMessageToUI(e){const s=document.createElement("div");s.className="msg";const a=e.uid===uid;s.classList.add(a?"me":"other"),s.innerHTML=`<strong>${e.name}</strong><br><span style="color:#aaa">${e.text}</span><br><small>${new Date(e.inserted_at).toLocaleTimeString()}</small>`,messagesDiv.appendChild(s),s.scrollIntoView()}async function loadMessages(){messagesDiv.innerHTML="";const{data:e,error:s}=await supabase.from("messages").select("*").eq("room",room).order("inserted_at",{ascending:!0});s?console.error("Erreur de chargement :",s):e.forEach(addMessageToUI)}supabase.channel("room_channel_"+room).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`room=eq.${room}`},e=>{addMessageToUI(e.new)}).subscribe(e=>{console.log("Abonnement WebSocket :",e)}),sendBtn.onclick=async()=>{const e=nameInput.value.trim(),s=msgInput.value.trim();e&&s&&(await supabase.from("messages").insert([{name:e,text:s,room:room,uid:uid}]),msgInput.value="")},loadMessages()</script></body></html>